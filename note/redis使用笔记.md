#Redis 使用笔记
[点击查看引用](https://www.zhihu.com/collection/210994692)
##缓存雪崩
* 现象：当redis集群宕机时，大量请求找不到缓存资源，于是直接去数据库中请求数据，瞬间大量查询将数据库拖垮。
* 对策：
  * 事前：redis高可用，主从+哨兵，redis集群式部署，保证redis自身到抗压能力。
  * 事中：适量增加本地缓存，hystrix限流+降级，避免数据库被拖垮。
  * 事后：redis持久化，一旦redis重启，通过持久化备份的数据，尽快恢复redis缓存数据。
#缓存穿透
* 现象：当一个缓存不存在时，就会直接去数据库查询。当出现大量这样的请求时，就会导致瞬间大量查询将数据库拖垮。例如，商品订单ID一般都是正整数
当黑客发现这一点，就会伪造大量商品ID为负数或小数或字符串的请求，因为这些key肯定没有缓存，请求就会直接打到数据库，将数据库拖垮。
* 对策：
  1. 分析商品ID的生成规则，将商品ID不符合的请求拦截。该方法只能拦截一部分伪请求。
  2. 对查询不到的资源也做缓存，并将过期时间设置很短（2分钟以内）。
#缓存击穿
* 现象：某个资源可能会在某个时间点成为热点资源，被海量请求访问。这时如果该资源的缓存过期或者因为内存问题丢失，就会导致大量请求直接打到数据库。
* 对策：使用"锁"，对从数据库拉取资源的操作加互斥锁，同一时间只能有一个请求可以进行该操作。竞争锁成功则获取资源并设置缓存，失败则线程休眠10ms后重试。